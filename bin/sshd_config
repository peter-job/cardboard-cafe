#!/bin/bash

display_usage() { 
	echo "Setup sshd configuration on remote server."
    echo "This script must be run with super-user privileges."
	} 

if [[ ( $1 == "--help") ||  $1 == "-h" ]] 
then 
    display_usage
    exit 0
fi 

TARGET=cardboard.cafe
USER=pi
SCRIPTS_DIR=$(dirname $BASH_SOURCE)
DOTFILES_DIR=$(cd $SCRIPTS_DIR && cd ../dotfiles && pwd)

ssh $USER@$TARGET "mkdir -p ~/.ssh && touch ~/.ssh/authorized_keys" && scp ~/.ssh/id_rsa.pub $USER@$TARGET:~/.ssh/authorized_keys
ssh $USER@$TARGET "mkdir -p ~/tmp" && scp -p $DOTFILES_DIR/sshd_config $USER@$TARGET:~/tmp/sshd_config
ssh $USER@$TARGET "sudo cp ~/tmp/sshd_config /etc/ssh/sshd_config"